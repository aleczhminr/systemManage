
@{
    ViewBag.Title = "新增代理商";
}

@Styles.Render("~/style/form")

<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
</div>
<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">

    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="panel-title">
                新增代理商
            </div>
        </div>
        <div class="panel-body">
            <form id="addAgentTable" action="/Agent/AddAgent" role="form" method="post">
                <div class="row no-margin">
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>真实姓名</label>
                            <input class="form-control" type="text" id="agentName" required="required" onblur="checkAndAutoGeneratedCode();" onkeyup="value = value.replace(/[^\u4E00-\u9FA5]/g,'')">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>代理商编号</label>
                            @*<div class="select-puppet">
                                <label>i200</label>
                                -
                                <select class="cs-select cs-skin-slide" id="agentId2">
                                    <option value='net' rel=''>net</option>
                                    <option value='dx' rel=''>dx</option>
                                    <option value='dm' rel=''>dm</option>
                                </select>
                                -
                                <input class="form-control inline" style="width: 240px;" type="text" id="agentId3" value="@ViewBag.AgentBh" required="required">
                            </div>*@
                            <input class="form-control" type="text" id="agentCode" required="required" maxlength="6">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>密码</label>
                            <input class="form-control" type="password" id="agentPwd" required="required">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>确认密码</label>
                            <input class="form-control" type="password" id="reAgentPwd" required="required">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>手机号</label>
                            <input class="form-control" type="text" id="agentPhone" minlength="11" maxlength="11" required="required">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>代理所在地</label>
                            <input class="form-control" type="text" id="agentAddress" required="required">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>所属服务分类</label>
                            <div class="select-puppet">
                                <select class="cs-select cs-skin-slide" id="serviceType">
                                    <option value='0' rel=''>代理商</option>
                                    <option value='1' rel=''>服务商</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>代理等级</label>
                            <div class="select-puppet">
                                <select class="cs-select cs-skin-slide" id="agentGrade">
                                    <option value='1' rel=''>1</option>
                                    <option value='2' rel=''>2</option>
                                    <option value='3' rel=''>3</option>
                                    <option value='4' rel=''>4</option>
                                    <option value='5' rel=''>5</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>身份证号</label>
                            <input class="form-control" type="text" required="required" id="agentIdCard">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>固定电话</label>
                            <input class="form-control" type="mobile" required="required" id="agentNumber">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>邮箱</label>
                            <input class="form-control" type="text" required="required" id="agentEmail">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>QQ号码</label>
                            <input class="form-control" type="text" required="required" id="agentQq">
                        </div>
                    </div>
                    <div class="col-sm-12 no-padding m-t-10">
                        <div class="form-group form-group-attached required">
                            <label>备注</label>
                            <input class="form-control" type="text" required="required" id="remark">
                        </div>
                    </div>
                </div>
                <button type="button" value="select" class="btn btn-success btn-inquire m-t-10 m-l-0" onclick="SaveAgent();">新增代理商</button>
            </form>
        </div>
    </div>
</div>
<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
</div>

@Scripts.Render("~/js/begin/form")
<script src="~/Scripts/plugins/jquery-validation/jquery.validate.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#addAgentTable").validate();
    });

    function SaveAgent() {
        var postJson = {};
        //postJson["agentId"] = "i200-" + $("#agentId2").val() + "-" + $("#agentId3").val();
        postJson["agentId"] = $("#agentCode").val();
        postJson["agentPwd"] = $("#agentPwd").val();
        postJson["agentPhone"] = $("#agentPhone").val();
        postJson["agentName"] = $("#agentName").val();
        postJson["agentAddress"] = $("#agentAddress").val();
        postJson["agentGrade"] = $("#agentGrade").val();
        postJson["agentIdCard"] = $("#agentIdCard").val();
        postJson["agentNumber"] = $("#agentNumber").val();
        postJson["agentEmail"] = $("#agentEmail").val();
        postJson["agentQq"] = $("#agentQq").val();
        postJson["remark"] = $("#remark").val();
        postJson["serviceType"] = $("#serviceType").val();

        var url = "/Agent/AddAgent";

        if ($("#agentPwd").val() != $("#reAgentPwd").val()) {
            alert("两次密码不一致！");
            return false;
        }

        $.doAjax(url, postJson, function (msg) {
            if (msg == "0") {
                alert("更新失败！");
            } else if ($("#addAgentTable").find("input[required='required']").val() == "") {
                alert("更新失败！");
            } else if(msg=="-1") {
                alert("已存在该ID，请重新输入ID！");
            }else {
                alert("更新成功！");
                location.href = '/Agent/Index';
            }
        }, true);

    }

    //产生代理商编码和并且校验
    function checkAndAutoGeneratedCode() {
        var postJson = {};
        var url = "/Agent/CheckAndAutoGeneratedCode";
        postJson["agentName"] = $("#agentName").val();
        $.doAjax(url, postJson, function (msg) {
            if (!msg) {
                alert("生成代理商编码失败，请重试！");
            } else {
                $("#agentCode").val(msg);
            }
        }, true);
    }
</script>